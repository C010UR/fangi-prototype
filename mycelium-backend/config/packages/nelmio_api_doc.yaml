nelmio_api_doc:
  html_config:
    assets_mode: offline
    stoplight_config:
      layout: "responsive"
      router: "hash"
  documentation:
    info:
      title: Mycelium
      version: 0.1.0
      description: "Fangi Mycelium is an Authentication and Authorization platform for Fangi ecosystem."
    x-logo:
      url: /logo.svg
      altText: Fangi Mycelium
      href: https://www.fangi.org/
    servers:
      - url: http://localhost:8000/
        description: "Local Mycelium API"
    components:
      schemas:
        Email:
          description: "Email."
          type: string
          example: "example@example.com"
          format: email
        Password:
          description: "Password."
          type: string
          example: "SuperStr0ngP#55w0rd!"
        MFAType:
          description: "MFA Type."
          type: string
          example: "email"
          enum: ["email"]
        MFAMethod:
          type: "object"
          required:
            - method
            - recipient
          properties:
            method:
              $ref: "#/components/schemas/MFAType"
            recipient:
              description: "Recipient of MFA code."
              type: string
              example: "ex****e@e******.com"
        DatabaseID:
          type: integer
          format: int32
          minimum: 0
          description: "ID."
          example: 82
        UUID:
          type: string
          format: uuid
          description: "UUID."
          example: "123e4567-e89b-12d3-a456-426614174000"
        UserRole:
          type: string
          enum: [ROLE_USER, ROLE_ADMIN]
          description: "Authorization Role."
          example: ROLE_USER
        UserShort:
          type: object
          required:
            - id
            - email
            - username
            - image_url
            - roles
            - is_active
            - is_banned
            - is_activated
            - created_by
            - created_at
            - updated_at
            - last_login_at
          properties:
            id:
              $ref: "#/components/schemas/DatabaseID"
            email:
              $ref: "#/components/schemas/Email"
            username:
              type: string
              description: "Username."
              example: "johndoe"
            image_url:
              type: string
              nullable: true
              description: "User image URL."
              example: "https://example.com/image.jpg"
            roles:
              type: array
              description: "User roles."
              items:
                $ref: "#/components/schemas/UserRole"
              minItems: 1
            is_active:
              type: boolean
              description: "Whether user is active."
              example: true
            is_banned:
              type: boolean
              description: "Whether user is banned."
              example: false
            is_activated:
              type: boolean
              description: "Whether user is activated."
              example: true
            created_by:
              type: string
              nullable: true
              description: "Who created the user (full name + email)."
              example: "Olivia Rhye (example@example.com)"
            created_at:
              type: string
              format: date-time
              description: "Date of creation."
              example: "2017-07-21T17:32:28Z"
            updated_at:
              type: string
              format: date-time
              description: "Date of the last update."
              example: "2017-07-21T17:32:28Z"
            last_login_at:
              type: string
              format: date-time
              description: "Date of the last login."
              example: "2017-07-21T17:32:28Z"
              nullable: true
        User:
          type: object
          required:
            - id
            - email
            - username
            - image_url
            - roles
            - servers
            - is_active
            - is_banned
            - is_activated
            - created_by
            - created_by_entity
            - created_at
            - updated_at
            - last_login_at
          properties:
            id:
              $ref: "#/components/schemas/DatabaseID"
            email:
              $ref: "#/components/schemas/Email"
            username:
              type: string
              description: "Username."
              example: "johndoe"
            image_url:
              type: string
              nullable: true
              description: "User image URL."
              example: "https://example.com/image.jpg"
            roles:
              type: array
              description: "User roles."
              items:
                $ref: "#/components/schemas/UserRole"
              minItems: 1
            servers:
              type: array
              description: "List of servers."
              items:
                $ref: "#/components/schemas/ServerShort"
              minItems: 1
            is_active:
              type: boolean
              description: "Whether user is active."
              example: true
            is_banned:
              type: boolean
              description: "Whether user is banned."
              example: false
            is_activated:
              type: boolean
              description: "Whether user is activated."
              example: true
            created_by:
              type: string
              nullable: true
              description: "Who created the user (full name + email)."
              example: "Olivia Rhye (example@example.com)"
            created_by_entity:
              $ref: "#/components/schemas/UserShort"
            created_at:
              type: string
              format: date-time
              description: "Date of creation."
              example: "2017-07-21T17:32:28Z"
            updated_at:
              type: string
              format: date-time
              description: "Date of the last update."
              example: "2017-07-21T17:32:28Z"
            last_login_at:
              type: string
              format: date-time
              description: "Date of the last login."
              example: "2017-07-21T17:32:28Z"
              nullable: true
        Module:
          type: object
          required:
            - id
            - name
            - image_url
            - description
            - client_id
            - urls
            - is_active
            - is_banned
            - created_by
            - created_by_entity
            - created_at
            - updated_at
          properties:
            id:
              $ref: "#/components/schemas/DatabaseID"
            name:
              type: string
              description: "Module name."
              example: "My Module"
            image_url:
              type: string
              nullable: true
              description: "Module image URL."
              example: "https://example.com/image.jpg"
            description:
              type: string
              nullable: true
              description: "Module description."
              example: "This is a module."
            client_id:
              $ref: "#/components/schemas/UUID"
            urls:
              type: array
              description: "List of allowed URLs."
              items:
                type: string
                example: "https://example.com"
            is_active:
              type: boolean
              description: "Whether module is active."
              example: true
            is_banned:
              type: boolean
              description: "Whether module is banned."
              example: false
            created_by:
              type: string
              nullable: true
              description: "Who created the module (full name + email)."
              example: "Olivia Rhye (example@example.com)"
            created_by_entity:
              $ref: "#/components/schemas/UserShort"
            created_at:
              type: string
              format: date-time
              description: "Date of creation."
              example: "2017-07-21T17:32:28Z"
            updated_at:
              type: string
              format: date-time
              description: "Date of the last update."
              example: "2017-07-21T17:32:28Z"
        ServerShort:
          type: object
          required:
            - id
            - name
            - image_url
            - allowed_urls
            - url
            - is_active
            - is_banned
            - created_by
            - created_at
            - updated_at
          properties:
            id:
              $ref: "#/components/schemas/DatabaseID"
            name:
              type: string
              description: "Server name."
              example: "Mycelium"
            image_url:
              type: string
              nullable: true
              description: "Server image URL."
              example: "https://example.com/image.jpg"
            allowed_urls:
              type: array
              description: "List of allowed URLs."
              items:
                type: string
                example: "https://example.com"
            url:
              type: string
              description: "First URL."
              example: "https://example.com"
            is_active:
              type: boolean
              description: "Whether server is active."
              example: true
            is_banned:
              type: boolean
              description: "Whether server is banned."
              example: false
            created_by:
              type: string
              nullable: true
              description: "Who created the server (full name + email)."
              example: "Olivia Rhye (example@example.com)"
            created_at:
              type: string
              format: date-time
              description: "Date of creation."
              example: "2017-07-21T17:32:28Z"
            updated_at:
              type: string
              format: date-time
              description: "Date of the last update."
              example: "2017-07-21T17:32:28Z"
        Server:
          type: object
          required:
            - id
            - name
            - image_url
            - allowed_urls
            - url
            - is_active
            - is_banned
            - created_by
            - created_by_entity
            - created_at
            - updated_at
          properties:
            id:
              $ref: "#/components/schemas/DatabaseID"
            name:
              type: string
              description: "Server name."
              example: "Mycelium"
            image_url:
              type: string
              nullable: true
              description: "Server image URL."
              example: "https://example.com/image.jpg"
            allowed_urls:
              type: array
              description: "List of allowed URLs."
              items:
                type: string
                example: "https://example.com"
            url:
              type: string
              description: "First URL."
              example: "https://example.com"
            is_active:
              type: boolean
              description: "Whether server is active."
              example: true
            is_banned:
              type: boolean
              description: "Whether server is banned."
              example: false
            created_by:
              type: string
              nullable: true
              description: "Who created the server (full name + email)."
              example: "Olivia Rhye (example@example.com)"
            created_by_entity:
              $ref: "#/components/schemas/UserShort"
            created_at:
              type: string
              format: date-time
              description: "Date of creation."
              example: "2017-07-21T17:32:28Z"
            updated_at:
              type: string
              format: date-time
              description: "Date of the last update."
              example: "2017-07-21T17:32:28Z"
        ServerAllowedModule:
          type: object
          required:
            - server
            - module
            - created_by
            - created_by_entity
            - created_at
            - updated_at
          properties:
            server:
              $ref: "#/components/schemas/Server"
            module:
              $ref: "#/components/schemas/Module"
            created_by:
              type: string
              nullable: true
              description: "Who created the entry (full name + email)."
              example: "Olivia Rhye (example@example.com)"
            created_by_entity:
              $ref: "#/components/schemas/UserShort"
            created_at:
              type: string
              format: date-time
              description: "Date of creation."
              example: "2017-07-21T17:32:28Z"
            updated_at:
              type: string
              format: date-time
              description: "Date of the last update."
              example: "2017-07-21T17:32:28Z"
        PasswordResetForm:
          type: object
          required:
            - password
          properties:
            password:
              type: string
              description: "User password."
              example: "SuperStr0ngP#55w0rd!"
        PasswordResetRequestForm:
          type: object
          required:
            - email
          properties:
            email:
              type: string
              format: email
              maxLength: 180
              description: "User email."
              example: "admin@example.com"
        RegistrationForm:
          type: object
          required:
            - email
            - username
            - image
            - password
          properties:
            email:
              type: string
              format: email
              maxLength: 180
              description: "User email."
              example: "user@example.com"
            username:
              type: string
              minLength: 3
              maxLength: 255
              description: "Username."
              example: "johndoe"
            image:
              type: string
              format: binary
              description: "User image file."
              nullable: true
            password:
              type: string
              description: "User password."
              example: "SuperStr0ngP#55w0rd!"
        ServerForm:
          type: object
          required:
            - name
            - image
            - urls
          properties:
            name:
              type: string
              minLength: 3
              maxLength: 255
              description: "Server name."
              example: "My Server"
            image:
              type: string
              format: binary
              description: "Server image file."
              nullable: true
            urls:
              type: array
              description: "List of allowed URLs."
              items:
                type: string
                format: uri
                example: "https://example.com"
              nullable: true
        ServerAllowedModuleForm:
          type: object
          required:
            - module
          properties:
            module:
              $ref: "#/components/schemas/DatabaseID"
        ModuleForm:
          type: object
          required:
            - name
            - image
            - description
            - urls
          properties:
            name:
              type: string
              minLength: 3
              maxLength: 255
              description: "Module name."
              example: "My Module"
            description:
              type: string
              nullable: true
              description: "Module description."
              example: "This is a module."
            image:
              type: string
              format: binary
              description: "Module image file."
              nullable: true
            urls:
              type: array
              description: "List of allowed URLs."
              items:
                type: string
                format: uri
                example: "https://example.com"
              nullable: true
        UserCreateForm:
          type: object
          required:
            - email
            - username
            - image
            - roles
            - servers
          properties:
            email:
              type: string
              format: email
              maxLength: 180
              description: "User email."
              example: "user@example.com"
            username:
              type: string
              minLength: 3
              maxLength: 255
              description: "Username."
              example: "johndoe"
            image:
              type: string
              format: binary
              description: "User image file."
              nullable: true
            roles:
              type: array
              description: "User roles."
              items:
                $ref: "#/components/schemas/UserRole"
              minItems: 1
            servers:
              type: array
              description: "List of server IDs."
              items:
                $ref: "#/components/schemas/DatabaseID"
              minItems: 1
        UserUpdateForm:
          type: object
          required:
            - username
            - image
            - roles
            - servers
          properties:
            username:
              type: string
              minLength: 3
              maxLength: 255
              description: "Username."
              example: "johndoe"
            image:
              type: string
              format: binary
              description: "User image file."
              nullable: true
            roles:
              type: array
              description: "User roles."
              items:
                $ref: "#/components/schemas/UserRole"
              minItems: 1
            servers:
              type: array
              description: "List of server IDs."
              items:
                $ref: "#/components/schemas/DatabaseID"
              minItems: 1
        ProfileUpdateForm:
          type: object
          required:
            - username
            - image
          properties:
            username:
              type: string
              minLength: 3
              maxLength: 255
              description: "Username."
              example: "johndoe"
            image:
              type: string
              format: binary
              description: "User image file."
              nullable: true
        AuthorizeForm:
          type: object
          required:
            - server
            - files
          properties:
            server:
              type: integer
              format: int32
              description: "Server ID."
              example: 1
            files:
              type: array
              description: "List of file paths."
              items:
                type: string
                format: uri
                example: "/path/to/file.txt"
              minItems: 1
        AuthorizationCodeExchangeForm:
          type: object
          oneOf:
            - title: Authorization Code Exchange
              required:
                - grant_type
                - redirect_uri
                - client_id
                - client_secret
                - code
              properties:
                grant_type:
                  type: string
                  enum: [authorization_code]
                  description: "Grant type."
                  example: "authorization_code"
                redirect_uri:
                  type: string
                  description: "Redirect URI."
                  example: "https://example.com/callback"
                client_id:
                  $ref: "#/components/schemas/UUID"
                client_secret:
                  type: string
                  description: "Client secret."
                  example: "SuperStr0ngP#55w0rd!"
                code:
                  type: string
                  description: "Authorization code."
                  example: "auth_code_123"
            - title: Refresh Token Exchange
              required:
                - grant_type
                - redirect_uri
                - client_id
                - client_secret
                - refresh_token
              properties:
                grant_type:
                  type: string
                  enum: [refresh_token]
                  description: "Grant type."
                  example: "refresh_token"
                redirect_uri:
                  type: string
                  description: "Redirect URI."
                  example: "https://example.com/callback"
                client_id:
                  $ref: "#/components/schemas/UUID"
                client_secret:
                  type: string
                  description: "Client secret."
                  example: "SuperStr0ngP#55w0rd!"
                refresh_token:
                  type: string
                  description: "Refresh token."
                  example: "refresh_token_123"
        ServerFile:
          type: object
          required:
            - path
            - parent
            - name
            - content_type
            - is_directory
            - created_by
            - updated_by
            - created_at
            - updated_at
          properties:
            path:
              type: string
              description: "File path."
              example: "/path/to/file.txt"
            parent:
              type: string
              nullable: true
              description: "Parent path."
              example: "/path/to"
            name:
              type: string
              description: "File name."
              example: "file.txt"
            content_type:
              type: string
              description: "File content type."
              example: "text/plain"
            is_directory:
              type: boolean
              description: "Whether the file is a directory."
              example: false
            created_by:
              type: string
              nullable: true
              description: "Who created the file (full name + email)."
              example: "Olivia Rhye (example@example.com)"
            updated_by:
              type: string
              nullable: true
              description: "Who updated the file (full name + email)."
              example: "Olivia Rhye (example@example.com)"
            created_at:
              type: string
              format: date-time
              description: "Date of creation."
              example: "2017-07-21T17:32:28Z"
            updated_at:
              type: string
              format: date-time
              description: "Date of the last update."
              example: "2017-07-21T17:32:28Z"
      securitySchemes:
        token_auth:
          type: http
          scheme: Bearer
          description: |
            Bearer token authentication.
            Provide your token in the Authorization header as: `Bearer <token>`
    security:
      - token_auth: ["c79cbf9fe36bb9d05d0639c70c265c18d37"]
    tags:
      - name: auth
        description: Authentication and session management endpoints.
      - name: mfa
        description: Multi-factor authentication endpoints.
      - name: password-reset
        description: Password reset endpoints.
      - name: registration
        description: Account registration endpoints.
      - name: servers
        description: Server management endpoints.
      - name: modules
        description: Module management endpoints.
      - name: users
        description: User management endpoints.
      - name: oauth
        description: OAuth 2.0 endpoints.
      - name: well-known
        description: Well-known endpoints.
  areas: # to filter documented areas
    path_patterns:
      - ^/api(?!/doc$) # Accepts routes under /api except /api/doc
      - ^/.well-known
      - ^/oauth
